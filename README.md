# è§†è§‰åˆ†æPipeline

å°†1å¼ è¾“å…¥å›¾ç‰‡å¤„ç†æˆ20å¼ è¾“å‡ºå›¾ç‰‡çš„å®Œæ•´Pipelineç³»ç»Ÿã€‚

## ğŸš€ æ–°åŠŸèƒ½: å¤šçº¿ç¨‹ä¼˜åŒ–

**é™¤GPUæ¨ç†å¤–çš„æ‰€æœ‰é˜¶æ®µç°å·²æ”¯æŒå¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†ï¼**

### æ€§èƒ½æå‡
- âš¡ **CPUå¯†é›†å‹é˜¶æ®µ**: 2-4å€åŠ é€Ÿ
- ğŸ“ **I/Oå¯†é›†å‹æ“ä½œ**: 3-6å€åŠ é€Ÿ  
- ğŸ¯ **æ•´ä½“æ€§èƒ½**: 1.5-3å€æå‡
- ğŸ’¾ **GPUåˆ©ç”¨ç‡**: æ˜¾è‘—æ”¹å–„

### å¿«é€Ÿå¼€å§‹
```bash
# è¿è¡Œäº¤äº’å¼ç¤ºä¾‹
./run_examples.sh

# å•å¼ å›¾ç‰‡ (å¤šçº¿ç¨‹)
python main.py input/test.jpg output/ --multithreaded --cpu-workers 4

# æ‰¹é‡å¤„ç† (é«˜æ€§èƒ½)
python batch_run_multithreaded.py input/ output/ --cpu-workers 6 --max-inflight-post 8

# æ€§èƒ½å¯¹æ¯”æµ‹è¯•
python quick_start.py input/test.jpg output/ --benchmark --cpu-workers 4
```

### å¤šçº¿ç¨‹ç‰ˆæœ¬æ–‡ä»¶
- ğŸ“„ `main_multithreaded.py` - å®Œæ•´å¤šçº¿ç¨‹Pipeline
- ğŸ“„ `batch_run_multithreaded.py` - é«˜æ€§èƒ½æ‰¹å¤„ç†å™¨
- ğŸ“„ `quick_start.py` - å¿«é€Ÿæµ‹è¯•å·¥å…·
- ğŸ“„ `test_multithreading.py` - æ€§èƒ½æµ‹è¯•è„šæœ¬
- ğŸ“– `MULTITHREADING_GUIDE.md` - è¯¦ç»†ä½¿ç”¨æŒ‡å—

---

## é¡¹ç›®ç»“æ„

```
AIåŸå¸‚æ™¯è§‚/
â”œâ”€â”€ main.py                 # ä¸»å…¥å£
â”œâ”€â”€ plan.md                 # è¯¦ç»†æŠ€æœ¯è§„èŒƒæ–‡æ¡£
â”œâ”€â”€ research_analysis.md     # ç®—æ³•ç ”ç©¶ä¸æ€§èƒ½åˆ†æ
â”œâ”€â”€ requirements.txt        # ä¾èµ–åŒ…
â”œâ”€â”€ README.md              # æœ¬æ–‡ä»¶
â””â”€â”€ pipeline/              # Pipelineæ¨¡å—
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ stage1_preprocess.py      # é˜¶æ®µ1: å›¾ç‰‡é¢„å¤„ç†
    â”œâ”€â”€ stage2_ai_inference.py    # é˜¶æ®µ2: AIæ¨¡å‹æ¨ç† (å¾…å®ç°)
    â”œâ”€â”€ stage3_postprocess.py     # é˜¶æ®µ3: åå¤„ç†ä¼˜åŒ– (å¾…å®ç°)
    â”œâ”€â”€ stage4_depth_layering.py  # é˜¶æ®µ4: æ™¯æ·±åˆ†å±‚ (å¾…å®ç°)
    â”œâ”€â”€ stage5_openness.py        # é˜¶æ®µ5: å¼€æ”¾åº¦è®¡ç®— (å¾…å®ç°)
    â”œâ”€â”€ stage6_generate_images.py # é˜¶æ®µ6: ç”Ÿæˆ20å¼ å›¾ç‰‡ (å¾…å®ç°)
    â””â”€â”€ stage7_save_outputs.py    # é˜¶æ®µ7: ä¿å­˜è¾“å‡º (å¾…å®ç°)
```

## åŠŸèƒ½æ¦‚è¿°

### 7ä¸ªå¤„ç†é˜¶æ®µ

1. **é˜¶æ®µ1: å›¾ç‰‡é¢„å¤„ç†** âœ…
   - è¯»å–å›¾ç‰‡æ–‡ä»¶
   - åˆ›å»ºå‰¯æœ¬
   - æå–å±æ€§
   - ç”Ÿæˆå…ƒæ•°æ®

2. **é˜¶æ®µ2: AIæ¨¡å‹æ¨ç†** âš ï¸ (ä»£ç æ¡†æ¶å·²å°±ç»ªï¼Œéœ€å®‰è£…æ¨¡å‹)
   - è¯­ä¹‰åˆ†å‰²: SAM 2.1 + LangSAM âœ… (ç²¾åº¦ä¼˜å…ˆæ–¹æ¡ˆ)
   - æ·±åº¦ä¼°è®¡: Depth Anything V2 âœ… (ç²¾åº¦ä¼˜å…ˆæ–¹æ¡ˆ)

3. **é˜¶æ®µ3: åå¤„ç†ä¼˜åŒ–** â³
   - æ™ºèƒ½ç©ºæ´å¡«å……
   - ä¸­å€¼æ»¤æ³¢å¹³æ»‘

4. **é˜¶æ®µ4: æ™¯æ·±åˆ†å±‚** â³
   - å‰æ™¯/ä¸­æ™¯/èƒŒæ™¯åˆ†å±‚

5. **é˜¶æ®µ5: å¼€æ”¾åº¦è®¡ç®—** â³
   - åŸºäºè¯­ä¹‰ç±»åˆ«çš„å¼€æ”¾åº¦æ˜ å°„

6. **é˜¶æ®µ6: ç”Ÿæˆ20å¼ å›¾ç‰‡** â³
   - åŸºç¡€åˆ†æå›¾ (4å¼ )
   - æ©ç å›¾ (3å¼ )
   - åŸå›¾ (1å¼ )
   - ç»„åˆåˆ†å±‚å›¾ (12å¼ )

7. **é˜¶æ®µ7: ä¿å­˜è¾“å‡º** â³
   - ä¿å­˜20å¼ PNGå›¾ç‰‡
   - ç”Ÿæˆå…ƒæ•°æ®JSON

## å®‰è£…

```bash
# 1. å®‰è£…åŸºç¡€ä¾èµ–
pip install -r requirements.txt

# 2. å®‰è£…AIæ¨¡å‹ (ç²¾åº¦ä¼˜å…ˆæ–¹æ¡ˆ)
# è¯¦ç»†æ­¥éª¤è§ INSTALLATION.md
# - SAM 2.1 + LangSAM
# - Depth Anything V2
```

**é‡è¦**: å®‰è£…AIæ¨¡å‹éœ€è¦GPUå’ŒCUDAæ”¯æŒï¼Œè¯¦ç»†å®‰è£…æ­¥éª¤è¯·æŸ¥çœ‹ `INSTALLATION.md`

## ä½¿ç”¨æ–¹æ³•

```bash
# åŸºæœ¬ç”¨æ³•
python main.py <å›¾ç‰‡è·¯å¾„> [è¾“å‡ºç›®å½•]

# ç¤ºä¾‹
python main.py input/photo.jpg output/
```

## é…ç½®

é»˜è®¤ä¼šè‡ªåŠ¨è¯»å–ä»“åº“æ ¹ç›®å½•çš„ `Semantic_configuration.json` ä½œä¸ºè¯­ä¹‰ç±»åˆ«/é¢œè‰²/å¼€æ”¾åº¦é…ç½®ã€‚

å¦‚éœ€æŒ‡å®šå…¶å®ƒè·¯å¾„ï¼Œå¯è®¾ç½®ç¯å¢ƒå˜é‡:

```bash
export PIPELINE_SEMANTIC_CONFIG=/path/to/Semantic_configuration.json
```

ä¹Ÿå¯ä»¥åœ¨ `main.py` ä¸­æ‰‹åŠ¨ä¿®æ”¹é…ç½®:

```python
config = {
    'classes': ['sky', 'grass', 'tree', 'building'],
    'openness_config': [1, 1, 0, 0],
    'colors': {...},
    'encoder': 'vitb',
    'enable_hole_filling': True,
    'enable_median_blur': True,
    ...
}
```

## æ€§èƒ½è€ƒè™‘

- **é¡¹ç›®è§„æ¨¡**: 140ä¸‡å¼ å›¾ç‰‡
- **å½“å‰çŠ¶æ€**: é˜¶æ®µ1å·²å®ç°ï¼Œå…¶ä»–é˜¶æ®µå¾…å®ç°
- **æ€§èƒ½ä¼˜åŒ–**: è§ `research_analysis.md`

## å¼€å‘çŠ¶æ€

- [x] é˜¶æ®µ1: é¢„å¤„ç†
- [ ] é˜¶æ®µ2: AIæ¨ç†
- [ ] é˜¶æ®µ3: åå¤„ç†
- [ ] é˜¶æ®µ4: æ™¯æ·±åˆ†å±‚
- [ ] é˜¶æ®µ5: å¼€æ”¾åº¦è®¡ç®—
- [ ] é˜¶æ®µ6: ç”Ÿæˆå›¾ç‰‡
- [ ] é˜¶æ®µ7: ä¿å­˜è¾“å‡º

## æµ‹è¯•

```bash
# æµ‹è¯•é˜¶æ®µ1
python pipeline/stage1_preprocess.py <å›¾ç‰‡è·¯å¾„>
```

## æ–‡æ¡£

- `plan.md`: å®Œæ•´çš„æŠ€æœ¯è§„èŒƒæ–‡æ¡£ (2109è¡Œ)
- `research_analysis.md`: ç®—æ³•ç ”ç©¶ä¸æ€§èƒ½åˆ†æ

## è®¸å¯è¯

å¾…å®š

